<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tap Swap Game</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <style>
    /* Ù‡Ù…Ø§Ù† Ú©Ø¯ Ø§Ø³ØªØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ */
  </style>
</head>
<body>
  <div class="game-container">
    <div class="header">ðŸš€ Tap Swap ðŸš€</div>
    <div class="score">Points: <span id="points">0</span></div>
    <div id="wallet-address" style="font-size: 14px; margin-bottom: 10px; color: gray;">
      Connect your wallet to start!
    </div>
    <button onclick="connectWallet()" style="margin-bottom: 20px;">Connect Wallet</button>
    <div class="coin" onclick="collectPoints(event)">
      <h1>ðŸ’°</h1>
    </div>
    <div class="shop">
      <h2>Shop</h2>
      <div class="shop-item" onclick="buyItem('clickPower')">
        <p><strong>Increase Click Power</strong></p>
        <p>Cost: <span id="clickPowerCost">50</span> Points</p>
      </div>
    </div>
    <div>
      <h3>Your Referral Link</h3>
      <input type="text" id="referral-link" readonly style="width: 100%; padding: 5px; border-radius: 5px;" value="Generate your link after connecting!">
    </div>
  </div>

  <script>
    let points = 0;
    let clickPower = 1;
    let clickPowerCost = 50;
    let userWallet = null;
    const userData = {}; // Temporary storage, replace with a database for persistence

    // Connect to MetaMask wallet
    async function connectWallet() {
      if (typeof window.ethereum !== 'undefined') {
        try {
          const provider = new ethers.providers.Web3Provider(window.ethereum);
          const accounts = await provider.send("eth_requestAccounts", []);
          userWallet = accounts[0];
          document.getElementById("wallet-address").textContent = `Wallet: ${userWallet}`;
          generateReferralLink();
          loadUserData();
        } catch (error) {
          alert("Failed to connect wallet: " + error.message);
        }
      } else {
        alert("MetaMask is not installed. Please install it to use this feature.");
      }
    }

    // Generate referral link
    function generateReferralLink() {
      if (userWallet) {
        const referralLink = `${window.location.href}?ref=${userWallet}`;
        document.getElementById("referral-link").value = referralLink;
      }
    }

    // Load user data
    function loadUserData() {
      if (userWallet && userData[userWallet]) {
        points = userData[userWallet].points || 0;
        clickPower = userData[userWallet].clickPower || 1;
        clickPowerCost = userData[userWallet].clickPowerCost || 50;
      }
      updateUI();
    }

    // Save user data
    function saveUserData() {
      if (userWallet) {
        userData[userWallet] = {
          points,
          clickPower,
          clickPowerCost,
        };
      }
    }

    // Anti-cheat validation (basic example)
    function validateCheatDetection() {
      // Example: Validate points based on server-side tracking or thresholds
      if (points < 0) {
        alert("Cheating detected!");
        points = 0;
        updateUI();
      }
    }

    // Collect points with animation
    function collectPoints(event) {
      points += clickPower;
      validateCheatDetection();
      saveUserData();
      updateUI();
    }

    // Buy items
    function buyItem(item) {
      if (item === 'clickPower' && points >= clickPowerCost) {
        points -= clickPowerCost;
        clickPower++;
        clickPowerCost *= 2; // Increase cost for next upgrade
        saveUserData();
      } else {
        alert('Not enough points!');
      }
      updateUI();
    }

    // Update UI
    function updateUI() {
      document.getElementById('points').textContent = points;
      document.getElementById('clickPowerCost').textContent = clickPowerCost;
    }

    // Initialize UI
    updateUI();
  </script>
</body>
</html>
